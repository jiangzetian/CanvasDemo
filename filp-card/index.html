<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>翻转卡片</title>
		<link href="css/index.css" rel="stylesheet"/>
		<script src="js/threejs/three.js"></script>
		<script src="js/threejs/tweenjs.js"></script>
		<script src="js/threejs/OrbitControls.js"></script>
	</head>
	<body>
		<div id="retina"></div>
	</body>
	<script>
		//页面加载完成
		window.onload = function(){
			create();
		}
		
		function create(){
			initRender();//创建渲染器
			initCamera();//创建相机
			initLight();//创建光源
			initObject();//创建物体1
			initObject_2();//物体2 立方体
			initObject_3()//物体3 圆环
			initObject_4()//物体4 椎体
			initObject_5()//物体5 圆柱体
			initObject_6()//物体6 四面体
			initSprite();//创建图片1
			initScene();//创建场景
			// initControls()//控制器
			initMouse()//鼠标监听
			render();//渲染
		}
		
		//渲染器
		var renderer;
		var width;
		var height;
		function initRender(){
			width = window.innerWidth;
			height = window.innerHeight;
			renderer = new THREE.WebGLRenderer({
				antialias:true,//抗锯齿开启
			})
			renderer.setSize(width,height);//设置渲染器宽高
			renderer.setClearColor('#000000',1.0);//设置背景颜色
			renderer.setPixelRatio(window.devicePixelRatio);//设置设备像素比
			document.getElementById('retina').appendChild(renderer.domElement);//把渲染器放入页面中
		}
		
		//相机
		var camera;
		var origPoint = new THREE.Vector3(0,0,0);
		function initCamera(){
			camera = new THREE.PerspectiveCamera(45,width/height,1,1000);
			camera.position.set(0,0,900);//相机位置
			camera.up.set(0,1,0)//设置相机正方向
			camera.lookAt(origPoint);//设置相机视点
		}
		
		//光源
		var pointLight;
		var ambientLight;
		function initLight(){
			//点光源
			pointLight = new THREE.PointLight(0xffffff);
			pointLight.position.set(-800,0,1000);
			//环境光
			ambientLight = new THREE.AmbientLight(0xffffff);
			ambientLight.position.set(0,0,2000);
		}
		
		//物体1
		var cube_1;
		function initObject(){
			var geometry = new THREE.BoxGeometry(300,500,10);
			var material = new THREE.MeshMatcapMaterial({color:0xffffff});
			cube_1 = new THREE.Mesh(geometry,material);
			cube_1.position.set(0,0,0);
			cube_1.name = 'cube_1';
		}
		
		//物体2 方块
		var cube_2;
		function initObject_2(){
			var geometry = new THREE.BoxGeometry(30,30,30);
			var material = new THREE.MeshPhongMaterial({color:0x3546FF});
			cube_2 = new THREE.Mesh(geometry,material);
			cube_2.position.set(-200,-80,400);
		}
		
		//物体3 圆环
		var cube_3;
		function initObject_3(){
			var geometry = new THREE.TorusBufferGeometry( 20, 8, 16, 100 );
			var material = new THREE.MeshPhongMaterial( { color: 0x3546FF } );
			cube_3 = new THREE.Mesh( geometry, material );
			cube_3.position.set(200,80,400);
		}
		
		//物体4 椎体
		var cube_4;
		function initObject_4(){
			var geometry = new THREE.ConeGeometry( 15, 40, 32 );
			var material = new THREE.MeshPhongMaterial( {color: 0x3546FF} );
			cube_4 = new THREE.Mesh( geometry, material );
			cube_4.position.set(0,0,500);
		}
		
		//物体5 圆柱体
		var cube_5;
		function initObject_5(){
			var geometry = new THREE.CylinderGeometry( 10, 10, 30, 32 );
			var material = new THREE.MeshPhongMaterial( {color: 0x3546FF} );
			cube_5 = new THREE.Mesh( geometry, material );
			cube_5.position.set(400,160,300);
		}
		
		//物体6 四面体
		var cube_6;
		function initObject_6(){
			var geometry = new THREE.TetrahedronBufferGeometry(20);
			var material = new THREE.MeshPhongMaterial( {color: 0x3546FF} );
			cube_6 = new THREE.Mesh( geometry, material );
			cube_6.position.set(-400,-160,300);
		}
		
		//图片1
		var image_1 ;
		function initSprite(){
			var spriteMap = new THREE.TextureLoader().load( "img/pic5.png" );
			var geometry = new THREE.BoxGeometry(260,440,0);
			var material = new THREE.MeshLambertMaterial({ map: spriteMap,transparent:true,});
			image_1 = new THREE.Mesh(geometry,material);
			image_1.position.set(0,0,100);
		} 
		
		
		//创建场景
		var scene;
		function initScene(){
			scene = new THREE.Scene();
			scene.add(pointLight);
			scene.add(ambientLight);
			scene.add(cube_1);
			scene.add(cube_2);
			scene.add(cube_3);
			scene.add(cube_4);
			scene.add(cube_5);
			scene.add(cube_6);
			scene.add(image_1);
		}
		
		//交互插件
		 var controls; 
		 function initControls() { 
		  controls = new THREE.OrbitControls( camera, renderer.domElement );
		 }
		
		//渲染
		function render(){
			renderer.clear();
				
			cube_2.rotation.x += 0.01;
			cube_2.rotation.y += 0.01;
			cube_2.rotation.z += 0.01;
			
			cube_3.rotation.x += 0.01;
			cube_3.rotation.y += 0.01;
			cube_3.rotation.z += 0.01;
			
			cube_4.rotation.x += 0.01;
			cube_4.rotation.y += 0.01;
			cube_4.rotation.z += 0.01;
			
			cube_5.rotation.x += 0.01;
			cube_5.rotation.y += 0.01;
			cube_5.rotation.z += 0.01;
			
			cube_6.rotation.x += 0.01;
			cube_6.rotation.y += 0.01;
			cube_6.rotation.z += 0.01;
			
			renderer.render(scene,camera);
			requestAnimationFrame(render);
		}
		
		//鼠标监听
		function initMouse(){
			var mouse = new THREE.Vector2();
			var raycaster = new THREE.Raycaster();
			//移动角度数据
			var rotationData = {x:0,y:0};
			//移动距离数据（图片）
			var positionData = {x:0,y:0};
			//鼠标移动监听
			document.onmousemove = function(e) {
				var mx = e.clientX;
				var my = e.clientY;
			    mouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;
			    mouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;
			    raycaster.setFromCamera( mouse, camera );
			    var intersects = raycaster.intersectObjects( scene.children );
			    if ( intersects.length > 0 ) {
					for(let i=0;i<intersects.length;i++){
						if(intersects[i].object.name == 'cube_1'){
							createjs.Tween.get(rotationData).to({x:Math.PI/12*(my-height/2)/250,y:Math.PI/12*(mx-width/2)/150},300).addEventListener('change',e=>{
								cube_1.rotation.set(rotationData.x,rotationData.y,0);
								image_1.rotation.set(rotationData.x,rotationData.y,0);
							},false);
							
							createjs.Tween.get(positionData).to({x:25*(mx-width/2)/150,y:-25*(my-height/2)/250}, 300).addEventListener('change',e=>{
								image_1.position.set(positionData.x,positionData.y,100);
							},false);
						}
					}
			    } else {
					createjs.Tween.get(rotationData).to({x:0,y:0}, 300).addEventListener('change',e=>{
						cube_1.rotation.set(rotationData.x,rotationData.y,0);
						image_1.rotation.set(rotationData.x,rotationData.y,0);
					},false);
					
					createjs.Tween.get(positionData).to({x:0,y:0}, 300).addEventListener('change',e=>{
						image_1.position.set(positionData.x,positionData.y,100);
					},false);
			    }
			};
		}
	</script>
</html>
