<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>翻转卡片</title>
		<link href="css/index.css" rel="stylesheet"/>
		<script src="js/threejs/three.js"></script>
	</head>
	<body>
		<div id="retina"></div>
	</body>
	<script>
		//页面加载完成
		window.onload = function(){
			create();
		}
		
		function create(){
			initRender();//创建渲染器
			initCamera();//创建相机
			initLight();//创建光源
			initObject();//创建物体
			initSprite();//创建图片
			initScene();//创建场景
			render();//渲染
		}
		
		//渲染器
		var renderer;
		var width;
		var height;
		function initRender(){
			width = window.innerWidth;
			height = window.innerHeight;
			renderer = new THREE.WebGLRenderer({
				antialias:true,//抗锯齿开启
			})
			renderer.setSize(width,height);//设置渲染器宽高
			renderer.setClearColor('#000000',1.0);//设置背景颜色
			renderer.setPixelRatio(window.devicePixelRatio);//设置设备像素比
			document.getElementById('retina').appendChild(renderer.domElement);//把渲染器放入页面中
		}
		
		//相机
		var camera;
		var origPoint = new THREE.Vector3(0,0,0)
		function initCamera(){
			camera = new THREE.PerspectiveCamera(45,width/height,1,1000);
			camera.position.set(0,0,900);//相机位置
			camera.up.set(0,1,0)//设置相机正方向
			camera.lookAt(origPoint);//设置相机视点
		}
		
		//光源
		var pointLight;
		var ambientLight;
		function initLight(){
			//点光源
			pointLight = new THREE.PointLight(0xffffff,1,2000);
			pointLight.position.set(0,0,900);
			//环境光
			ambientLight = new THREE.AmbientLight(0xffffff);
			pointLight.position.set(0,0,900);
		}
		
		//物体
		var cube;
		function initObject(){
			var geometry = new THREE.BoxGeometry(300,500,10);
			var material = new THREE.MeshLambertMaterial({color:0xffffff});
			cube = new THREE.Mesh(geometry,material);
			cube.position.set(0,0,0);
		}
		
		//图片
		var sprite ;
		function initSprite(){
			var spriteMap = new THREE.TextureLoader().load( "img/pic5.png" );
			var geometry = new THREE.BoxGeometry(260,440,0);
			var material = new THREE.MeshLambertMaterial({ map: spriteMap,transparent:true,});
			sprite = new THREE.Mesh(geometry,material);
			sprite.position.set(0,0,100);
		} 
		
		
		//创建场景
		var scene;
		function initScene(){
			scene = new THREE.Scene();
			// scene.add(pointLight);
			scene.add(ambientLight);
			scene.add(cube);
			scene.add(sprite);
		}
		
		//渲染
		function render(){
			renderer.clear();
			renderer.render(scene,camera);
			requestAnimationFrame(render);
		}
		
		//事件
		// document.addEventListener('mousemove',e=>{
		// 	let mx = e.clientX;
		// 	let my = e.clientY;
		// 	if(Math.abs(width/2-mx)<=200 && Math.abs(height/2-my)<=320){
		// 		cube.rotation.set(Math.PI/14*(my-height/2)/250,Math.PI/14*(mx-width/2)/150,0);
		// 		sprite.rotation.set(Math.PI/14*(my-height/2)/250,Math.PI/14*(mx-width/2)/150,0);
		// 		sprite.position.set(20*(mx-width/2)/150,-20*(my-height/2)/250,100);
		// 	}else{
		// 		cube.rotation.set(0,0,0);
		// 		sprite.rotation.set(0,0,0)
		// 		sprite.position.set(0,0,100);
		// 	}
		// });
		var mouse = new THREE.Vector2();
		var raycaster = new THREE.Raycaster();
		document.onmousemove = function(e) {
			let mx = e.clientX;
			let my = e.clientY;
		    mouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;
		    mouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;
		    raycaster.setFromCamera( mouse, camera );
		    var intersects = raycaster.intersectObjects( scene.children );
		    if ( intersects.length > 0 ) {
				cube.rotation.set(Math.PI/14*(my-height/2)/250,Math.PI/14*(mx-width/2)/150,0);
				sprite.rotation.set(Math.PI/14*(my-height/2)/250,Math.PI/14*(mx-width/2)/150,0);
				sprite.position.set(20*(mx-width/2)/150,-20*(my-height/2)/250,100);
		    } else {
				cube.rotation.set(0,0,0);
				sprite.rotation.set(0,0,0)
				sprite.position.set(0,0,100);
		    }
		};
	</script>
</html>
